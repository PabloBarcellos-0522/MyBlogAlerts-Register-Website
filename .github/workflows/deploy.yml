# Fluxo de trabalho para build e deploy no GitHub Pages
name: Deploy to GitHub Pages

on:
    # Roda quando h치 um push na branch main
    push:
        branches:
            - main
            - master
    workflow_dispatch:

permissions:
    contents: read
    pages: write
    id-token: write

env:
    API_BASE_URL: ${{ vars.API_BASE_URL }}

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest
        steps:
            - name: 拘勇 Checkout do c칩digo
              uses: actions/checkout@v4

            - name: 游댃 Substituir URL da API
              run: |
                  # Verifica se o script original existe
                  if [ ! -f script.js ]; then
                  echo "script.js n칚o foi encontrado!"
                  exit 1
                  fi

                  # Usa sed para encontrar a linha do placeholder e substitu칤-la pela vari치vel.
                  # O resultado 칠 salvo em um arquivo tempor치rio e depois movido de volta,
                  # para modificar o script que ser치 usado no deploy.
                  TEMP_SCRIPT=$(mktemp)
                  sed "s|const API_BASE_URL = \".*\";|const API_BASE_URL = \"$API_BASE_URL\";|" script.js > "$TEMP_SCRIPT" && mv "$TEMP_SCRIPT" script.js

                  echo "URL substitu칤da. Verificando o conte칰do de script.js:"
                  grep "API_BASE_URL" script.js
            - name: 拘勇 Upload do Artefato para o Pages
              uses: actions/upload-pages-artifact@v3
              with:
                  # Faz o upload do diret칩rio raiz
                  path: "."

            - name: 游 Deploy no GitHub Pages
              id: deployment
              uses: actions/deploy-pages@v4
