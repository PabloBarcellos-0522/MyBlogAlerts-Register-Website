# Fluxo de trabalho para build e deploy no GitHub Pages
name: Deploy to GitHub Pages

on:
    # Roda quando h√° um push na branch main
    push:
        branches:
            - main
            - master
    workflow_dispatch:

permissions:
    contents: read
    pages: write
    id-token: write

env:
    API_BASE_URL: ${{ vars.API_BASE_URL }}

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest
        steps:
            - name: ‚¨áÔ∏è Checkout do c√≥digo
              uses: actions/checkout@v4

            - name: üß™ Debug da vari√°vel de ambiente
              run: |
                echo "API_BASE_URL recebido pelo workflow:"
                echo "API_BASE_URL=$API_BASE_URL"

                if [ -z "$API_BASE_URL" ]; then
                  echo "‚ùå ERRO: API_BASE_URL est√° vazia"
                  exit 1
                fi

            - name: üîÑ Substituir URL da API no script.js
              run: |
                FILE="script.js"

                if [ ! -f "$FILE" ]; then
                  echo "‚ùå ERRO: $FILE n√£o encontrado na raiz do projeto"
                  exit 1
                fi

                echo "üìÑ Conte√∫do ANTES da substitui√ß√£o:"
                grep "API_BASE_URL" "$FILE"

                sed -i "s|const API_BASE_URL *= *\"[^\"]*\"|const API_BASE_URL = \"$API_BASE_URL\"|g" "$FILE"

                echo "üìÑ Conte√∫do DEPOIS da substitui√ß√£o:"
                grep "API_BASE_URL" "$FILE"
            - name: ‚¨ÜÔ∏è Upload do Artefato para o Pages
              uses: actions/upload-pages-artifact@v3
              with:
                # Faz o upload do diret√≥rio raiz
                path: "."

            - name: üöÄ Deploy no GitHub Pages
              id: deployment
              uses: actions/deploy-pages@v4
