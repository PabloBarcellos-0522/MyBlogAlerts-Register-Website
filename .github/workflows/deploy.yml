# Fluxo de trabalho para build e deploy no GitHub Pages
name: Deploy to GitHub Pages

on:
    # Roda quando h치 um push na branch main
    push:
        branches:
            - main
            - master
    workflow_dispatch:

permissions:
    contents: read
    pages: write
    id-token: write

env:
    API_BASE_URL: ${{ vars.API_BASE_URL }}

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest
        steps:
            - name: 拘勇 Checkout do c칩digo
              uses: actions/checkout@v4

            - name: 游댃 Substituir URL da API
              run: |
                  # Verifica se o arquivo de template existe
                  if [ ! -f script.js ]; then
                    echo "Erro: script.js n칚o encontrado!"
                    exit 1
                  fi
                  # Copia o script.js para um template tempor치rio
                  cp script.js script.template.js
                  # Substitui o placeholder pela vari치vel de ambiente e cria o script.js final
                  sed -i "s|const API_BASE_URL = ".*";|const API_BASE_URL = "${API_BASE_URL}";|" script.template.js
                  mv script.template.js script.js

            - name: 拘勇 Upload do Artefato para o Pages
              uses: actions/upload-pages-artifact@v3
              with:
                  # Faz o upload do diret칩rio raiz
                  path: "."

            - name: 游 Deploy no GitHub Pages
              id: deployment
              uses: actions/deploy-pages@v4
